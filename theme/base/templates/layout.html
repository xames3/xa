<!--
Base Layout Template
====================

Author: Akshay Mestry <xa@mes3.dev>
Created on: 21 February, 2025
Last updated on: 07 February, 2026
-->
{%- set lang_attr = "en" if language == None else (language|replace('_','-')) -%}
<!DOCTYPE html>
<html lang="{{ lang_attr }}"
      {% if sphinx_version_tuple>= (7, 2) %}data-content_root="{{ content_root }}"{% endif %}
      :data-theme="darkMode"
      x-data="{darkMode: localStorage.getItem('darkMode') ?? 'dark'}"
      x-init="if (!localStorage.getItem('darkMode')) { localStorage.setItem('darkMode', darkMode); } const applyTheme = window.simpleApplyTheme ?? ((val) => { document.documentElement.classList.add('theme-transition'); requestAnimationFrame(() => { document.documentElement.setAttribute('data-theme', val); setTimeout(() => document.documentElement.classList.remove('theme-transition'), 700); }); }); $watch('darkMode', val => { applyTheme(val); localStorage.setItem('darkMode', val); });"
      class="scroll-smooth"
      :class="{'dark': darkMode === 'dark' || (darkMode === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)}"
      x-effect="document.documentElement.setAttribute('data-theme', darkMode)">
    <head>
        <meta name="viewport"
              content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta name="theme-color"
              media="(prefers-color-scheme: light)"
              content="white" />
        <meta name="theme-color"
              media="(prefers-color-scheme: dark)"
              content="black" />
        {{ metatags }}
        <script>
            document.documentElement.classList.add('no-transitions');
            const userPreference = localStorage.getItem('darkMode');
            const mode = userPreference || 'dark';
            document.documentElement.setAttribute('data-theme', mode);
            if (mode === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            if (!userPreference) {
                localStorage.setItem('darkMode', mode)
            }
        </script>
        {%- block htmltitle %}
            <title>{{ title|striptags|e if title else docstitle }}</title>
            <meta property="og:title"
                  content="{{ title|striptags|e if title else docstitle }}" />
            <script src="https://kit.fontawesome.com/8bcdaaff4d.js"
                    crossorigin="anonymous"></script>
            <script data-goatcounter="https://xa.goatcounter.com/count"
                    async
                    src="//gc.zgo.at/count.js"></script>
        {%- endblock htmltitle %}
        {%- for css in css_files %}
            {%- if css|attr("filename") %}
                {{ css_tag(css) }}
            {%- else -%}
                <link rel="stylesheet"
                      href="{{ pathto(css, 1) |e }}" />
            {%- endif %}
        {%- endfor %}
        {%- set _favicon_ico_url = favicon_url | default(pathto('_static/' + (favicon or ""), 1)) %}
        {%- set _favicon_16_url = pathto('_static/' + favicons.size_16, 1) %}
        {%- set _favicon_32_url = pathto('_static/' + favicons.size_32, 1) %}
        {%- set _favicon_180_url = pathto('_static/' + favicons.size_180, 1) %}
        {%- set _favicon_manifest_url = pathto('_static/' + favicons.manifest, 1) %}
        {%- if favicon_url or favicon %}
            <link rel="icon"
                  href="{{ _favicon_ico_url }}" />
            <link rel="icon"
                  type="image/png"
                  sizes="16x16"
                  href="{{ _favicon_16_url }}">
            <link rel="icon"
                  type="image/png"
                  sizes="32x32"
                  href="{{ _favicon_32_url }}">
            <link rel="apple-touch-icon"
                  sizes="180x180"
                  href="{{ _favicon_180_url }}">
            <link rel="manifest"
                  href="{{ _favicon_manifest_url }}">
        {%- endif %}
        {%- block linktags %}
            {%- if hasdoc('search') %}
                <link rel="search"
                      title="{{ _('Search') }}"
                      href="{{ pathto('search') }}" />
            {%- endif %}
            {%- if hasdoc('genindex') %}
                <link rel="index"
                      title="{{ _('Index') }}"
                      href="{{ pathto('genindex') }}" />
            {%- endif %}
            {%- if next %}
                <link rel="next"
                      title="{{ next.title|striptags|e }}"
                      href="{{ next.link|e }}" />
            {%- endif %}
            {%- if prev %}
                <link rel="prev"
                      title="{{ prev.title|striptags|e }}"
                      href="{{ prev.link|e }}" />
            {%- endif %}
        {%- endblock linktags %}
        {%- block extrahead %}{%- endblock extrahead %}
        </head>
        <body x-data="{ showSidebar: false, showScrollTop: false, lastScroll: 0 }"
              class="site-body"
              :class="{ 'site-body--locked': showSidebar, 'site-body--sidebar-open': showSidebar }"
              @scroll.window="const y=pageYOffset; const docH=document.documentElement.scrollHeight; const nearBottom=(y+innerHeight)>= (docH-200); const down=y>lastScroll; showScrollTop = down && (y>200 || nearBottom); lastScroll = y < 0 ? 0 : y;">
            {%- if sidebars|length > 0 %}
                <div x-cloak
                     x-show="showSidebar"
                     class="site-sidebar__backdrop"
                     @click.self="showSidebar = false"></div>
            {%- endif %}
            <div id="page"
                 class="site-shell">
                <a href="#content"
                   class="site-shell__skip-link">Skip to content</a>
                {%- block header %}
                    {%- include "header.html.jinja" %}
                {%- endblock header %}
                <div class="site-shell__main">
                    <div class="site-layout container {% if show_toctree|tobool %}site-layout--nav-in-header{% endif %}">
                        {%- block left_sidebar %}
                            {%- include "left_sidebar.html.jinja" %}
                        {%- endblock left_sidebar %}
                        {%- block main %}
                            <main class="site-layout__content">
                                {%- block body %}{%- endblock %}
                                </main>
                                {%- if show_previous_next_pages|tobool %}
                                    {%- include "previous_next_pages.html.jinja" %}
                                {%- endif %}
                            {%- endblock main %}
                            {%- block right_sidebar %}{%- endblock right_sidebar %}
                            </div>
                        </div>
                        {%- block footer %}
                            {%- include "footer.html.jinja" %}
                        {%- endblock footer %}
                    </div>
                    {% block scripts %}
                        {%- for js in script_files %}{{ js_tag(js) }}{%- endfor %}
                            <script>
                                window.addEventListener('load', function() {
                                    requestAnimationFrame(function() {
                                        document.documentElement.classList.remove('no-transitions');
                                    });
                                });
                            </script>
                        {% endblock scripts %}
                    </body>
                </html>
